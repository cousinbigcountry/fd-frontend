module.exports=[87808,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(65733),h=a.i(88237);function i(){let[a,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),L=(0,c.useMemo)(()=>a.filter(a=>"CLIENT"===a.type),[a]);async function M(a){k(!0),m(null);try{let b=a?`/api/people?q=${encodeURIComponent(a)}`:"/api/people",c=await fetch(b,{cache:"no-store"}),d=await c.json().catch(()=>null);if(!c.ok)throw Error(d?.message??d?.error??"Failed to load CRM");i(Array.isArray(d)?d:[])}catch(a){m(a?.message??"Failed to load CRM")}finally{k(!1)}}async function N(a){try{let b=await fetch("/api/people/report",{cache:"no-store"}),c=await b.json().catch(()=>null);if(!b.ok)return;let d=(Array.isArray(c?.rows)?c.rows:[]).find(b=>b.id===a&&"CLIENT"===b.type);d?.roleOrCompany&&A(d.roleOrCompany)}catch{}}async function O(a){s(a),u(a.firstName??""),w(a.lastName??""),y(a.email??""),A(""),C(null),q(!0),await N(a.id)}async function P(){if(C(null),!t.trim()||!v.trim()||!x.trim()||!z.trim())return void C("First name, last name, email, and company name are required.");let a={firstName:t.trim(),lastName:v.trim(),email:x.trim(),companyName:z.trim(),department:"CLIENT"};try{let b=await fetch(r?`/api/people/clients/${r.id}`:"/api/people/clients",{method:r?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json().catch(()=>null);if(!b.ok)throw Error(c?.message??c?.error??"Save failed");q(!1),await M(n.trim()||void 0)}catch(a){C(a?.message??"Save failed")}}async function Q(a){m(null);try{let b=await fetch(`/api/people/${a.id}`,{method:"DELETE"}),c=await b.json().catch(()=>null);if(!b.ok)throw Error(c?.message??c?.error??"Delete failed");await M(n.trim()||void 0)}catch(a){m(a?.message??"Delete failed")}}async function R(){await M(n.trim()||void 0)}async function S(){G(!0),I(null);try{let a=await fetch("/api/people/report",{cache:"no-store"}),b=await a.json().catch(()=>null);if(!a.ok)throw Error(b?.message??b?.error??"Report failed");K(b)}catch(a){I(a?.message??"Report failed"),K(null)}finally{G(!1)}}(0,c.useEffect)(()=>{M()},[]);let T=(0,c.useMemo)(()=>(J?.rows??[]).filter(a=>"CLIENT"===a.type),[J]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"CRM"}),j&&(0,b.jsx)("p",{className:"text-sm text-white/60",children:"Loading…"}),l&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:l})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Dialog,{open:p,onOpenChange:q,children:[(0,b.jsx)(g.DialogTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{className:"bg-white text-black hover:bg-white/90",onClick:function(){s(null),u(""),w(""),y(""),A(""),C(null),q(!0)},children:"Add Client"})}),(0,b.jsxs)(g.DialogContent,{className:"bg-zinc-950 text-white border-white/10",children:[(0,b.jsx)(g.DialogHeader,{children:(0,b.jsx)(g.DialogTitle,{children:r?"Edit Client":"Add Client"})}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(f.Input,{value:t,onChange:a=>u(a.target.value),placeholder:"First name",className:"bg-white/5 border-white/10"}),(0,b.jsx)(f.Input,{value:v,onChange:a=>w(a.target.value),placeholder:"Last name",className:"bg-white/5 border-white/10"}),(0,b.jsx)(f.Input,{value:x,onChange:a=>y(a.target.value),placeholder:"Email",className:"bg-white/5 border-white/10"}),(0,b.jsx)(f.Input,{value:z,onChange:a=>A(a.target.value),placeholder:"Company name",className:"bg-white/5 border-white/10"}),B&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:B}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,b.jsx)(e.Button,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/15",onClick:()=>q(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{className:"bg-white text-black hover:bg-white/90",onClick:P,children:"Save"})]})]})]})]}),(0,b.jsxs)(g.Dialog,{open:D,onOpenChange:a=>{E(a),a&&S()},children:[(0,b.jsx)(g.DialogTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/15",children:"Generate Report"})}),(0,b.jsxs)(g.DialogContent,{className:"bg-zinc-950 text-white border-white/10 max-w-3xl",children:[(0,b.jsx)(g.DialogHeader,{children:(0,b.jsx)(g.DialogTitle,{children:"CRM Report"})}),F&&(0,b.jsx)("p",{className:"text-sm text-white/60",children:"Generating…"}),H&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:H}),J&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("p",{className:"font-medium",children:J.title}),(0,b.jsxs)("p",{className:"text-white/60",children:["Generated: ",new Date(J.generatedAt).toLocaleString()]})]}),(0,b.jsx)("div",{className:"max-h-[45vh] overflow-auto rounded-lg border border-white/10",children:(0,b.jsxs)(h.Table,{children:[(0,b.jsx)(h.TableHeader,{children:(0,b.jsxs)(h.TableRow,{children:[(0,b.jsx)(h.TableHead,{className:"text-white/70",children:"Code"}),(0,b.jsx)(h.TableHead,{className:"text-white/70",children:"Name"}),(0,b.jsx)(h.TableHead,{className:"text-white/70",children:"Email"}),(0,b.jsx)(h.TableHead,{className:"text-white/70",children:"Company"})]})}),(0,b.jsxs)(h.TableBody,{children:[T.map(a=>(0,b.jsxs)(h.TableRow,{className:"border-white/10",children:[(0,b.jsx)(h.TableCell,{className:"text-white/90",children:a.code??""}),(0,b.jsxs)(h.TableCell,{className:"text-white/90",children:[a.firstName," ",a.lastName]}),(0,b.jsx)(h.TableCell,{className:"text-white/90",children:a.email}),(0,b.jsx)(h.TableCell,{className:"text-white/90",children:a.roleOrCompany??""})]},a.id)),0===T.length&&(0,b.jsx)(h.TableRow,{className:"border-white/10",children:(0,b.jsx)(h.TableCell,{colSpan:4,className:"text-center text-white/60 py-10",children:"No clients found."})})]})]})}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(e.Button,{className:"bg-white text-black hover:bg-white/90",onClick:()=>E(!1),children:"Close"})})]})]})]})]})]}),(0,b.jsxs)(d.Card,{className:"bg-white/5 border-white/10",children:[(0,b.jsxs)(d.CardHeader,{className:"space-y-3",children:[(0,b.jsx)(d.CardTitle,{className:"text-base",children:"Clients"}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,b.jsx)(f.Input,{value:n,onChange:a=>o(a.target.value),placeholder:"Search by last name or email…",className:"bg-white/5 border-white/10 text-white"}),(0,b.jsx)(e.Button,{onClick:R,className:"bg-white text-black hover:bg-white/90",children:"Search"})]})]}),(0,b.jsx)(d.CardContent,{className:"overflow-auto",children:(0,b.jsxs)(h.Table,{children:[(0,b.jsx)(h.TableHeader,{children:(0,b.jsxs)(h.TableRow,{className:"border-white/10",children:[(0,b.jsx)(h.TableHead,{className:"text-white/70",children:"Code"}),(0,b.jsx)(h.TableHead,{className:"text-white/70",children:"Name"}),(0,b.jsx)(h.TableHead,{className:"text-white/70",children:"Email"}),(0,b.jsx)(h.TableHead,{className:"text-right text-white/70",children:"Actions"})]})}),(0,b.jsxs)(h.TableBody,{children:[L.map(a=>(0,b.jsxs)(h.TableRow,{className:"border-white/10",children:[(0,b.jsx)(h.TableCell,{className:"text-white/90",children:a.code??""}),(0,b.jsxs)(h.TableCell,{className:"text-white/90",children:[a.firstName," ",a.lastName]}),(0,b.jsx)(h.TableCell,{className:"text-white/90",children:a.email}),(0,b.jsx)(h.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"secondary",className:"bg-white/10 text-white hover:bg-white/15",onClick:()=>O(a),children:"Edit"}),(0,b.jsx)(e.Button,{size:"sm",variant:"destructive",className:"bg-red-600/80 hover:bg-red-600",onClick:()=>Q(a),children:"Delete"})]})})]},a.id)),!j&&0===L.length&&(0,b.jsx)(h.TableRow,{className:"border-white/10",children:(0,b.jsx)(h.TableCell,{colSpan:4,className:"text-center text-white/60 py-10",children:"No clients found."})})]})]})})]})]})}a.s(["default",()=>i])}];

//# sourceMappingURL=app_%28portal%29_crm_page_tsx_2f569819._.js.map